# 03 – API Routes Specification  
## CMMS Dashboard Backend API (In-Memory v1)  
## Version: v1.0 (Fully Detailed)

This document defines **all API endpoints, input/output schemas, validation rules, and expected behaviors** for the CMMS application backend.

Cursor MUST follow this specification exactly when implementing API routes in Next.js (App Router API endpoints).

---

# 1. General Rules for All Endpoints

Cursor MUST apply the following rules to ALL API routes:

### ✔ Use Next.js App Router route handlers  
File structure:
```
/app/api/<resource>/route.ts
/app/api/<resource>/<id>/route.ts
```

### ✔ Response Format (Always JSON)
Successful response:
```json
{
  "success": true,
  "data": ...
}
```

Error response:
```json
{
  "success": false,
  "error": "Message explaining the issue"
}
```

### ✔ Status Codes
- **200** → OK  
- **201** → Created  
- **400** → Validation error  
- **404** → Not found  
- **500** → Internal server error  

### ✔ Data Source (v1)
Use **in-memory arrays** imported from:
```
/lib/data/workOrders
/lib/data/assets
/lib/data/technicians
/lib/data/inventory
```

---

# 2. WORK ORDERS API

Work orders represent maintenance tasks. These endpoints allow reading and creating work orders.

---

## 2.1 GET /api/workorders  
Returns **all work orders**, sorted by `createdAt` DESC.

### Example Response
```json
{
  "success": true,
  "data": [
    {
      "id": "WO-001",
      "title": "Replace HVAC Filter – Unit 3",
      "priority": "High",
      "status": "Open",
      "assignedTo": "T-001",
      "assetId": "A-001",
      "createdAt": "2025-01-10T09:00:00Z",
      "dueDate": "2025-01-12T17:00:00Z"
    }
  ]
}
```

### Rules
- MUST sort by `createdAt` descending.
- No pagination in v1.
- Acceptable query parameters (optional, v1):
  - `status`
  - `priority`
  - `assetId`

---

## 2.2 POST /api/workorders  
Creates a new work order.

### Required Body
```json
{
  "title": "Fix pump nozzle",
  "assetId": "A-005",
  "priority": "Medium"
}
```

### Optional Fields
- description  
- dueDate  
- assignedTo  

### Auto-Filled Fields
- `id` → generated by server (`WO-###`)  
- `status` → MUST default to `"Open"`  
- `createdAt` → MUST be an ISO timestamp  

### Validation Rules
Cursor MUST validate the POST body:

- `title` → required  
- `assetId` → required AND must match `Asset.id`  
- `priority` → required  
- `assignedTo` → if provided must match `Technician.id`  
- `dueDate` → optional but MUST be valid ISO date  

If invalid:
```json
{
  "success": false,
  "error": "Invalid request body"
}
```

---

## 2.3 PATCH /api/workorders/[id]  
Updates a specific work order.

### Allowed fields in v1:
- title  
- description  
- status  
- priority  
- assignedTo  
- dueDate  
- completedAt (special rules)

### Status Transition Rules
Cursor MUST enforce:

| From         | To            |
|--------------|----------------|
| Open         | In Progress    |
| In Progress  | Completed      |
| Open         | Cancelled      |

### Completed Work Orders
If `status = "Completed"`:
- MUST include `completedAt`
- `completedAt` must be a valid ISO timestamp

If `status != "Completed"`:
- MUST NOT include `completedAt`

### Not Found Error
```json
{
  "success": false,
  "error": "Work order not found"
}
```

---

# 3. ASSETS API

---

## 3.1 GET /api/assets  
Returns all assets.

### Example Response
```json
{
  "success": true,
  "data": [
    {
      "id": "A-001",
      "name": "HVAC Unit – Store 1",
      "location": "Store #1 – Roof",
      "status": "Active"
    }
  ]
}
```

### Rules
- MUST sort alphabetically by `name`
- Must include all Asset fields

---

## 3.2 GET /api/assets/[id]  
Returns one asset by ID.

### Not Found
```json
{
  "success": false,
  "error": "Asset not found"
}
```

---

# 4. TECHNICIANS API

---

## 4.1 GET /api/technicians  
Returns list of technicians.

### Rules
- MUST sort by technician `name` ascending
- MUST include:
  - id
  - name
  - email
  - phone (if exists)
  - active

### Optional Future